{"version":3,"file":"microweb.js","sources":["../../src/utils.ts","../../src/source.ts","../../src/types.ts","../../src/app.ts","../../src/element.ts","../../src/index.ts"],"sourcesContent":["/**\r\n * 获取静态资源\r\n * @param {string} entry 静态资源地址\r\n * @returns\r\n */\r\nexport function fetchSource(entry: string): Promise<string> {\r\n  return fetch(entry).then(res => {\r\n    return res.text();\r\n  });\r\n}\r\n","import { MicroApp } from \"./types\";\r\nimport { fetchSource } from \"./utils\";\r\n\r\n/**\r\n * 访问微应用资源\r\n * @param app 微应用实例对象\r\n */\r\nexport default function loadHtml(app: MicroApp) {\r\n  fetchSource(app.entry)\r\n    .then(html => {\r\n      html = html\r\n        .replace(/<head[^>]*>[\\s\\S]*?<\\/head>/i, match => {\r\n          // 将head标签替换为micro-app-head，因为web页面只允许有一个head标签\r\n          return match.replace(/<head/i, \"<microweb-head\").replace(/<\\/head>/i, \"</microweb-head>\");\r\n        })\r\n        .replace(/<body[^>]*>[\\s\\S]*?<\\/body>/i, match => {\r\n          // 将body标签替换为micro-app-body，防止与基座应用的body标签重复导致的问题。\r\n          return match.replace(/<body/i, \"<microweb-body\").replace(/<\\/body>/i, \"</microweb-body>\");\r\n        });\r\n      // 将html字符串转化为DOM结构\r\n      const htmlDom = document.createElement(\"div\");\r\n      htmlDom.innerHTML = html;\r\n      // 进一步提取和处理js、css等静态资源\r\n      extractSourceDom(htmlDom, app);\r\n      //获取micro-app-head元素\r\n      const microWebHead = htmlDom.querySelector(\"microweb-head\");\r\n      // 如果有远程css资源，则通过fetch请求\r\n      if (app.source.links.size) {\r\n        fetchLinksFromHtml(app, microWebHead, htmlDom);\r\n      } else {\r\n        app.onLoad(htmlDom);\r\n      }\r\n      //如果有远程js资源，则通过fetch请求\r\n      if (app.source.scripts.size) {\r\n        fetchScriptsFromHtml(app, htmlDom);\r\n      } else {\r\n        app.onLoad(htmlDom);\r\n      }\r\n    })\r\n    .catch(e => {\r\n      console.error(\"加载html出错\", e);\r\n    });\r\n}\r\n/**\r\n * 递归处理每一个子元素\r\n * @param { Element } parent 父元素\r\n * @param { MicroApp } app 应用实例\r\n */\r\nexport function extractSourceDom(parent: Element, app: MicroApp) {\r\n  const children = Array.from(parent.children); //Element.children是类数组对象，没有数组特有的方法\r\n  //递归每一个子元素\r\n  children.length &&\r\n    children.forEach(child => {\r\n      extractSourceDom(child, app);\r\n    });\r\n  for (const dom of children) {\r\n    if (dom instanceof HTMLLinkElement) {\r\n      //提取css地址\r\n      const href = dom.getAttribute(\"href\");\r\n      if (dom.getAttribute(\"rel\") === \"stylesheet\" && href) {\r\n        //记入source缓存中\r\n        app.source.links.set(href, {\r\n          code: \"\", //代码内容\r\n        });\r\n      }\r\n      //删除原有元素\r\n      parent.removeChild(dom);\r\n    } else if (dom instanceof HTMLScriptElement) {\r\n      const src = dom.getAttribute(\"src\");\r\n      if (src) {\r\n        //远程script\r\n        app.source.scripts.set(src, {\r\n          code: \"\", //代码内容\r\n          isExternal: true, //是否远程script\r\n        });\r\n      } else if (dom.textContent) {\r\n        //内联script\r\n        const nonceStr = Math.random().toString(36).slice(2, 16); //生成包含(0-9a-z)随机字符串\r\n        app.source.scripts.set(nonceStr, {\r\n          code: dom.textContent, //代码内容\r\n          isExternal: false, //是否远程script\r\n        });\r\n      }\r\n      parent.removeChild(dom);\r\n    } else if (dom instanceof HTMLStyleElement) {\r\n      //进行样式隔离\r\n    }\r\n  }\r\n}\r\n/**\r\n * 获取link远程资源\r\n * @param app 微应用实例\r\n * @param microWebHead microweb-head\r\n * @param htmlDom 微应用\r\n */\r\nexport function fetchLinksFromHtml(\r\n  app: MicroApp,\r\n  microWebHead: Element | null,\r\n  htmlDom: Element\r\n): void {\r\n  const linkEntries = Array.from(app.source.links.entries());\r\n  //通过fetch请求所有css资源\r\n  const fetchLinkPromise: Array<Promise<string>> = [];\r\n  for (const [url] of linkEntries) {\r\n    fetchLinkPromise.push(fetchSource(url));\r\n  }\r\n  Promise.all(fetchLinkPromise)\r\n    .then(res => {\r\n      for (let i = 0, len = res.length; i < len; i++) {\r\n        const code = res[i];\r\n        //拿到css资源后放入style元素并插入到microweb-head中\r\n        const linkSheetStyle = document.createElement(\"style\");\r\n        linkSheetStyle.textContent = code;\r\n        microWebHead?.appendChild(linkSheetStyle);\r\n        //将代码放入缓存，再次渲染时可以从缓存中获取\r\n        linkEntries[i][1].code = code;\r\n      }\r\n      //处理完成后执行onLoad方法\r\n      app.onLoad(htmlDom);\r\n    })\r\n    .catch(e => {\r\n      console.error(\"加载css出错\", e);\r\n    });\r\n}\r\n/**\r\n * 获取js远程资源\r\n * @param app 微应用实例\r\n * @param htmlDom 微应用dom结构\r\n */\r\nexport function fetchScriptsFromHtml(app: MicroApp, htmlDom: Element): void {\r\n  const scriptEntries = Array.from(app.source.scripts.entries());\r\n  //通过fetch请求所有js资源\r\n  const fetchScriptPromise: Array<Promise<string>> = [];\r\n  for (const [url, info] of scriptEntries) {\r\n    //如果是内联script，则不需要请求资源\r\n    fetchScriptPromise.push(info.isExternal ? fetchSource(url) : Promise.resolve(info.code));\r\n  }\r\n  Promise.all(fetchScriptPromise)\r\n    .then(res => {\r\n      for (let i = 0; i < res.length; i++) {\r\n        const code = res[i];\r\n        //将代码放入缓存，再次渲染时可以从缓存中获取\r\n        scriptEntries[i][1].code = code;\r\n      }\r\n      app.onLoad(htmlDom);\r\n    })\r\n    .catch(e => {\r\n      console.error(\"加载js出错\", e);\r\n    });\r\n}\r\n","export interface CreateAppType {\r\n  name: string;\r\n  entry: string;\r\n  container: Element;\r\n}\r\nexport interface AppSourceMap {\r\n  links: Map<string, AppSourceMapValue>;\r\n  scripts: Map<string, AppSourceMapValue>;\r\n  html: Element | null;\r\n}\r\nexport interface MicroApp {\r\n  name: string;\r\n  entry: string;\r\n  container: Element | null;\r\n  status: string;\r\n  source: AppSourceMap;\r\n  onLoad(dom: Element): void;\r\n  unmount(isDestory: boolean): void;\r\n}\r\nexport type AppSourceMapValue = {\r\n  code: string;\r\n  isExternal?: boolean;\r\n};\r\n\r\nexport enum AppStatus {\r\n  CREATED = \"CREATED\",\r\n  MOUNTED = \"MOUNTED\",\r\n  UNMOUNT = \"UNMOUNT\",\r\n  LOADING = \"LOADING\",\r\n}\r\n//created/loading/mount/unmount\r\n","import loadHtml from \"./source\";\r\nimport { AppSourceMap, AppStatus, CreateAppType, MicroApp } from \"./types\";\r\n\r\nexport default class CreateApp {\r\n  public loadCount: number = 0;\r\n  public name: string;\r\n  public entry: string;\r\n  public container: Element | null;\r\n  public status: string = AppStatus.CREATED; // 组件状态，包括created/loading/mounted/unmount\r\n  public source: AppSourceMap = {\r\n    links: new Map(), //link元素对应的静态资源\r\n    scripts: new Map(), //script元素对应的静态资源\r\n    html: null,\r\n  };\r\n\r\n  constructor({ name, entry, container }: CreateAppType) {\r\n    this.name = name; // 应用名称\r\n    this.entry = entry; // 应用地址\r\n    this.container = container; //应用容器\r\n    this.status = AppStatus.LOADING;\r\n    loadHtml(this);\r\n  }\r\n  /**\r\n   * 资源加载完时执行\r\n   */\r\n  onLoad(htmlDom: Element): void {\r\n    this.loadCount = this.loadCount ? this.loadCount + 1 : 1;\r\n    //第二次执行且组件未卸载时执行渲染\r\n    if (this.loadCount === 2 && this.status !== AppStatus.UNMOUNT) {\r\n      //记录DOM结构用于后续操作\r\n      this.source.html = htmlDom;\r\n      this.mount();\r\n    }\r\n  }\r\n  /**\r\n   * 资源加载完成后进行渲染\r\n   */\r\n  mount(): void {\r\n    //克隆DOM节点\r\n    const cloneHtml = this.source.html?.cloneNode(true)!; //非空断言运算符，从值域中排除null、undefined\r\n    //创建一个fragment节点作为模板，这样不会产生冗余的元素\r\n    const fragment = document.createDocumentFragment();\r\n    Array.from(cloneHtml.childNodes).forEach(node => {\r\n      fragment.appendChild(node);\r\n    });\r\n    //将格式化后的DOM结构插入到容器中\r\n    this.container!.appendChild(fragment);\r\n    //执行js\r\n    this.source.scripts.forEach(info => {\r\n      try {\r\n        (0, eval)(info.code);\r\n      } catch (error) {\r\n        console.error(\"微应用执行js代码错误!\", error);\r\n      }\r\n    });\r\n    //标记应用为已渲染\r\n    this.status = AppStatus.MOUNTED;\r\n  }\r\n  /**\r\n   * 卸载应用\r\n   * @param destory 是否完全销毁，删除缓存资源\r\n   */\r\n  unmount(destory: boolean): void {\r\n    //更新状态\r\n    this.status = AppStatus.UNMOUNT;\r\n    //清空容器\r\n    this.container = null;\r\n    //destory为true，则删除应用\r\n    if (destory) {\r\n      appInstanceMap.delete(this.name);\r\n    }\r\n  }\r\n}\r\nexport const appInstanceMap: Map<string, MicroApp> = new Map();\r\n","import CreateApp, { appInstanceMap } from \"./app\";\r\nclass MicroElement extends HTMLElement {\r\n  static get observedAttributes() {\r\n    return [\"name\", \"entry\"];\r\n  }\r\n  constructor() {\r\n    super();\r\n  }\r\n  public appName: string = \"\";\r\n  public appEntry: string = \"\";\r\n  /**\r\n   * 自定义元素被插入到DOM时执行，此时去加载子应用的静态资源并渲染\r\n   */\r\n  public connectedCallback() {\r\n    console.log(\"micro-app is connected\");\r\n    //创建微应用实例\r\n    const app = new CreateApp({ name: this.appName, entry: this.appEntry, container: this });\r\n    //记入缓存，用于后续功能\r\n    appInstanceMap.set(this.appName, app);\r\n  }\r\n  /**\r\n   * 自定义元素从DOM中删除时执行，此时进行一些卸载操作\r\n   */\r\n  public disconnectedCallback() {\r\n    console.log(\"micro-app has disconnected\");\r\n    //获取应用实例\r\n    const app = appInstanceMap.get(this.appName)!;\r\n    //如果有属性destory，则完全卸载应用包括缓存的文件\r\n    app.unmount(this.hasAttribute(\"destory\"));\r\n  }\r\n  /**\r\n   * 元素属性发生变化时执行，可以获取name，entry等属性的值\r\n   * @param attr\r\n   * @param oldVal\r\n   * @param newVal\r\n   */\r\n  public attributeChangedCallback(attr: string, oldVal: string, newVal: string) {\r\n    console.log(`attribute ${attr}: ${newVal}`);\r\n    if (attr === \"name\" && !this.appName && newVal) {\r\n      this.appName = newVal;\r\n    } else if (attr === \"entry\" && !this.appEntry && newVal) {\r\n      this.appEntry = newVal;\r\n    }\r\n  }\r\n}\r\nexport function defineElement() {\r\n  //如果已经定义过，则忽略\r\n  if (!window.customElements.get(\"micro-web\")) {\r\n    /**\r\n     * 注册元素\r\n     * 注册后，就可以像普通元素一样使用micro-web，当micro-web元素被插入或删除DOM时即可触发相应的生命周期函数。\r\n     */\r\n    window.customElements.define(\"micro-web\", MicroElement);\r\n  }\r\n}\r\n","import { defineElement } from \"./element\";\r\n\r\nconst MicroWeb = {\r\n  start() {\r\n    defineElement();\r\n  },\r\n};\r\n\r\nexport default MicroWeb;\r\n"],"names":[],"mappings":"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"}